#!/bin/bash

#list in "scripts", the scripts to run tests in subdirectories.
#list in "compare", the folders to execute comparison tests
#  for all the *.cmp files in those folders
#

scripts="
fast/Readme
infrastructure/Readme
"

compare="
ivoc/Random
nrniv/NetCon
nrniv/SaveState
nmodl nmodl/FOR_NETCONS nmodl/functiontable nmodl/LONGDIFUS
nmodl/order nmodl/WATCH
"


cmpprog=`pwd`/testutil/cmpdatfile

err=0

runscript()
{
  d=`dirname $1`
  s=`basename $1`
  echo "
Running test $1"
  (cd $d && bash $s)
  return $?
}

runcompare()
{
  d=$1
  echo "
Running cmpdatfile in $1"
  (cd $d && $cmpprog *.cmp)
  return $?
}

for i in $scripts ; do
    runscript $i
    if [ $? -ne 0 ] ; then
        err=1
    fi
done

for i in $compare ; do
    runcompare $i
    if [ $? -ne 0 ] ; then
        err=1
    fi
done

echo ""
if [ $err -eq 0 ] ; then
    echo "All tests successful"
else
    echo "One or more tests failed"
fi

exit $err
